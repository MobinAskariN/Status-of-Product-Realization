@{
    ViewData["Title"] = "Graph";
    var labels = ViewBag.Labels as List<GraphWithLabels.Models.Label>;
    var edges = ViewBag.Edges as List<(GraphWithLabels.Models.Vertex, GraphWithLabels.Models.Vertex)>;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>
    <style>
        svg {
            border: 1px solid black;
        }

        .vertex {
            fill: blue;
            cursor: pointer;
        }

        .edge {
            stroke: black;
            stroke-width: 1;
        }

        .label {
            font-size: 12px;
            fill: black;
        }

        .tooltip {
            position: absolute;
            padding: 5px;
            background: lightgray;
            border: 1px solid black;
            border-radius: 3px;
            pointer-events: none;
            display: none;
        }
    </style>
</head>
<body>
    <h1>Graph</h1>

    <svg width="800" height="500" id="graph">
        <!-- Define the arrowhead marker -->
        <defs>
            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                <polygon points="0 0, 10 3.5, 0 7" />
            </marker>
        </defs>

        @foreach (var label in labels)
        {
            var labelX = 100 + label.index * 150;  // Increase horizontal spacing for each label
            var labelY = 30; // Fixed Y position for labels

            @Html.Raw($"<text x='{labelX}' y='{labelY}' class='label'>{label.name}</text>")

            int vertexSpacing = 400 / (label.vertices.Count + 1); // Adjust vertex spacing
            for (int i = 0; i < label.vertices.Count; i++)
            {
                var cy = 100 + vertexSpacing * (i + 1);
                var vertex = label.vertices[i];
                @Html.Raw($"<circle cx='{labelX}' cy='{cy}' r='5' class='vertex' data-label='{label.index}' data-vertex='{vertex.vertexIndex}' />")
            }
        }

        @foreach (var edge in edges)
        {
            var startX = 100 + edge.Item1.labelIndex * 150;
            var startY = 100 + 400 / (labels[edge.Item1.labelIndex].vertices.Count + 1) * (edge.Item1.vertexIndex + 1);
            var endX = 100 + edge.Item2.labelIndex * 150;
            var endY = 100 + 400 / (labels[edge.Item2.labelIndex].vertices.Count + 1) * (edge.Item2.vertexIndex + 1);

            @Html.Raw($"<line x1='{startX}' y1='{startY}' x2='{endX}' y2='{endY}' class='edge' marker-end='url(#arrowhead)' />")
        }
    </svg>

    <div id="tooltip" class="tooltip"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tooltip = document.getElementById('tooltip');
            const graph = document.getElementById('graph');

            graph.addEventListener('mouseover', function (e) {
                if (e.target.tagName === 'circle') {
                    const label = e.target.getAttribute('data-label');
                    const vertex = e.target.getAttribute('data-vertex');
                    tooltip.innerHTML = `Label: ${label}, Vertex: ${vertex}`;
                    tooltip.style.display = 'block';
                }
            });

            graph.addEventListener('mousemove', function (e) {
                if (e.target.tagName === 'circle') {
                    tooltip.style.left = e.pageX + 10 + 'px';
                    tooltip.style.top = e.pageY + 10 + 'px';
                }
            });

            graph.addEventListener('mouseout', function (e) {
                if (e.target.tagName === 'circle') {
                    tooltip.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
